load("ecdsa.sage")

if __name__ == "__main__":
    _, E, G, n = params()
    messages4 = [
        b"This is message number 0",
        b"This is message number 1",
        b"This is message number 2",
        b"This is message number 3",
        b"This is message number 4",
        b"This is message number 5",
        b"This is message number 6",
        b"This is message number 7",
        b"This is message number 8",
        b"This is message number 9",
        b"This is message number 10",
        b"This is message number 11",
        b"This is message number 12",
        b"This is message number 13",
        b"This is message number 14",
        b"This is message number 15",
        b"This is message number 16",
        b"This is message number 17",
        b"This is message number 18",
        b"This is message number 19",
    ]
    signatures4 = [
        (
            37673961370743096164045747776764714614130027261390717320603297680938738739133098670472068312833007076727544907252407,
            18203877769786955482482676508764912653624704768388740194241268201163324328880613151763352077887744552972419291454834,
        ),
        (
            15218531100931798793286773172608932479277976078046090923920176390453788811910375742051017028280037852488183072048855,
            4211736573053633420907312787718566676680859206588586297046364564559138152434266800063962576349268941184495751620020,
        ),
        (
            7686134237014942857566908588959290133139476866606317828380655788733412606797105306451316528159769022254465008202588,
            21246657534002778073380591404209916403229262488547529368616895085816966134459905171793987023677086978792271547820566,
        ),
        (
            12406548178503445373198366087218605001828611327843928952895159258303607540643870718895097826272829193757006833676043,
            14370091177080734873953273798650176442319229966306763343181611949628778168569160270931235582801340250745572559038828,
        ),
        (
            18960322218894543253031172673317636200986337308274639975537495963949473836807042287187826522460429523698169042902255,
            23478129805470475251700777065447410396668189218480093558116488137734749279676725489524272993432268233825350925617098,
        ),
        (
            33273892905267730267794130979103349549102928989743553785605819375290236618296526136342357675763878551848038597129060,
            16293756347354545244627896844614738456640202284158231051310716412449840846062611950749811653551345765557681266333065,
        ),
        (
            14835638875398731435248668289535266052347506742197427698177905144091740135402200534166813455516763378193328457890142,
            24459750266000200259198331396828233200946702420143932750773450485968207734504901039209116885004509882945138557351934,
        ),
        (
            37276586546831294552289304542479970690872901466317428225682281009209512169277103956272029184983449016461081460946979,
            37032807323026950169994421765413857879301847724264555994031867976657306978457344920062159657876886511073093722050495,
        ),
        (
            16643489404651748756513124451122726418592935185919808568291163160228495045396081342173977990508360057959659138338643,
            12210333838933632171470589752035837063351380043904447442984966050311325392759038651600976110880889956948881086590193,
        ),
        (
            26241752733237044188869764105084486714689746990496516931310283424688919043958364893145626920142098403347459981923073,
            12126958336930229702455411840662710244018359528566354706661445421186860887367192005290174614659107301816982341786136,
        ),
        (
            32767608740031902547753122674327258821756250267591562413261526123645704513171633540690273547965669499949990634646203,
            4673474196624013642359691579565430290540228453987521107200756476662239770813809088063992936724108046554118914834510,
        ),
        (
            15669187740279098228512711975191257556462815684144171807725733230862839622572521607739560468960340089317922377012759,
            33823186011733005605636058188163904854003671763315762329002197604976212917149393264275614908162248600687321026882360,
        ),
        (
            13473777157752438017211096514416984886936690796299789826312873057105211260516766944556142292717088965159231405411186,
            31024142037999032476060887610728594929851572772057212683840704902095818287443514327255539524488211739164927336496260,
        ),
        (
            16013966670430680035180929282438961354643982234717354369235193677536162658506975724192751322389023972446043714732853,
            37203985952812936632953092417522883401054343187213211100481710986729246461233878350699775656255713877497248145592286,
        ),
        (
            11788765591785528747783263163199208252795328396351867891760066632854624979746921873116104799541396365705487862112995,
            33008136262020762894985494123443048246294472986048005697686082085176494499337403877387091563486720725359238441427145,
        ),
        (
            3680702091142953860641445877271125208628017814338716876333116005986930124836351637613595947926725428118208058537345,
            20526365277117254210866940904909772379643136554600077547599456446397931766124543260990830887849666409211918210965311,
        ),
        (
            22266163551991014949290870646378825571952498939520093464701853809993971807930432011415268495944657413336553391424321,
            17618081245042499932441502680319760551612904132333328522142404781624107980292192438227283637024290139648107577351449,
        ),
        (
            37615326439451698201415640160543443984580077083618746521646485034388001759501705776650716753008067181292814250243895,
            2814302193694327558909280439497787753799072467815896663717484744649792157033694148075313864719181018874442573743867,
        ),
        (
            39390643239609318955275375671672121399592664791120422860420385602237871713687123601328647481269616764747125444951265,
            14797548204980407431174512391108719871510780621337996125559237035012091027552887811708233988073016517664085610522455,
        ),
        (
            31366222351338136653450381014063866815960318917116964573901904372521936946391200504566595143847983561084223371993285,
            12200298260653535117484470436959005824618964577070258044859357805985011239861204506985549716812620163867075404007878,
        ),
    ]
    A4 = (
        19720366803126139522044084026979645499798844040229224759299102560392657456005881732938124920204186424453444775200837,
        20331697749315728850858413489170908005673506367983063411257352621028305578208097920813941868493826091275512999907582,
    )

    # Establish relation between ECDSA and HNP
    B = pow(2, 256)
    m = len(messages4) if len(messages4) == len(signatures4) else None
    space = MatrixSpace(QQ, m + 2, m + 2)
    M = space.identity_matrix() * n
    for j, (message, (r, s)) in enumerate(zip(messages4, signatures4)):
        inv_s = inverse_mod(s, n)
        M[m, j] = r * inv_s  # This is t_i
        M[m + 1, j] = -(h(message) * inv_s)  # This is a_i
    M[m, m] = B / n
    M[m + 1, m + 1] = B
    reduced = M.LLL()

    # Test every row of `reduced`
    # and try to extract alpha
    key = None
    for row in reduced.rows():
        candidate = ((-1) * row * n / B)[-2] % n
        public = int(candidate) * G
        if public[0] == A4[0] and public[1] == A4[1]:
            print("Got it!")
            print("The private key is:", candidate)
            key = candidate
    if not key:
        print("No match found.")
